# CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹ç™ºãƒ«ãƒ¼ãƒ«

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #4 ã§ã®è¤‡æ•°ã®CIå¤±æ•—ã‹ã‚‰å­¦ã‚“ã æ•™è¨“ã‚’åŸºã«ã€åŒæ§˜ã®å•é¡Œã‚’é˜²ããŸã‚ã®é–‹ç™ºãƒ«ãƒ¼ãƒ«ã‚’å®šã‚ã¦ã„ã¾ã™ã€‚

## âŒ ç™ºç”Ÿã—ãŸå•é¡Œã®åˆ†æ

### PR #4 ã§ç™ºç”Ÿã—ãŸä¸»ãªå•é¡Œ
- **9å€‹ã®ã‚³ãƒŸãƒƒãƒˆä¸­6å€‹ãŒã€Œfix:ã€** - CIå¤±æ•—ã«ã‚ˆã‚‹ç¹°ã‚Šè¿”ã—ä¿®æ­£
- **Docker Composeæ§‹æ–‡ã‚¨ãƒ©ãƒ¼** - V1ã¨V2ã®é•ã„
- **ä¾å­˜é–¢ä¿‚ä¸æ•´åˆ** - package.json â†” package-lock.json
- **æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰æ®‹å­˜** - golangci-lint ã‚¨ãƒ©ãƒ¼
- **ãƒ†ã‚¹ãƒˆè¨­å®šä¸å‚™** - Jestè¨­å®šã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸è¶³
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼** - Prettierè¨­å®šä¸å‚™

## âœ… å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®

### 1. ã‚³ãƒŸãƒƒãƒˆå‰ã®ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼

#### Backend (Go)
```bash
# Lintãƒã‚§ãƒƒã‚¯
docker run --rm -v $(pwd)/backend:/app -w /app golangci/golangci-lint:latest golangci-lint run

# ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
docker run --rm -v $(pwd)/backend:/app -w /app golang:1.23-alpine go build ./...

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker run --rm -v $(pwd)/backend:/app -w /app golang:1.23-alpine go test ./...
```

#### Frontend (React Native/TypeScript)
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm ci

# Lintãƒã‚§ãƒƒã‚¯
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm run lint

# å‹ãƒã‚§ãƒƒã‚¯
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm run type-check

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm run format:check

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm test -- --coverage --watchAll=false

# ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
docker run --rm -v $(pwd)/frontend:/app -w /app node:18-alpine npm run build
```

### 2. ãƒ—ãƒƒã‚·ãƒ¥å‰ã®çµ±åˆãƒ†ã‚¹ãƒˆ

```bash
# å…¨ä½“ã®Docker Composeãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
docker compose build
docker compose -f docker-compose.prod.yml build

# é–‹ç™ºç’°å¢ƒèµ·å‹•ãƒ†ã‚¹ãƒˆ
docker compose up --build -d
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèªå¾Œ
docker compose down
```

### 3. ä¾å­˜é–¢ä¿‚ç®¡ç†ãƒ«ãƒ¼ãƒ«

#### Frontendä¾å­˜é–¢ä¿‚
- **package.jsonå¤‰æ›´æ™‚**: å¿…ãš`npm install`å®Ÿè¡Œå¾Œã€`package-lock.json`ã‚‚ã‚³ãƒŸãƒƒãƒˆ
- **æ–°è¦ä¾å­˜é–¢ä¿‚è¿½åŠ æ™‚**:
  - æœ¬ç•ªä¾å­˜é–¢ä¿‚: `npm install <package>`
  - é–‹ç™ºä¾å­˜é–¢ä¿‚: `npm install --save-dev <package>`
  - ãƒ”ã‚¢ä¾å­˜é–¢ä¿‚ç«¶åˆæ™‚: `--legacy-peer-deps`ãƒ•ãƒ©ã‚°ä½¿ç”¨

#### Backendä¾å­˜é–¢ä¿‚
- **go.modå¤‰æ›´æ™‚**: `go mod tidy`å®Ÿè¡Œã‚’å¿˜ã‚Œãšã«
- **æœªä½¿ç”¨import**: golangci-lintã§è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹ãŸã‚äº‹å‰ãƒã‚§ãƒƒã‚¯å¿…é ˆ

### 4. ãƒ†ã‚¹ãƒˆè¨­å®šãƒ«ãƒ¼ãƒ«

#### æ–°æ©Ÿèƒ½è¿½åŠ æ™‚
- **Backend**: å¯¾å¿œã™ã‚‹å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å¿…ãšä½œæˆ
- **Frontend**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’å¿…ãšä½œæˆ
- **ãƒ†ã‚¹ãƒˆãŒ0ä»¶ã®å ´åˆ**: `--passWithNoTests`ãƒ•ãƒ©ã‚°ã§åŸºæœ¬ãƒ†ã‚¹ãƒˆã‹ã‚‰å§‹ã‚ã‚‹

#### ãƒ†ã‚¹ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- **Jestè¨­å®š**: æ–°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯`jest.config.json`ã‚’ä½œæˆ
- **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**: å¿…è¦ãªä¾å­˜é–¢ä¿‚ï¼ˆ`@testing-library/*`, `jest-environment-jsdom`ç­‰ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 5. ã‚³ãƒ¼ãƒ‰å“è³ªãƒ«ãƒ¼ãƒ«

#### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆçµ±ä¸€
- **äº‹å‰ãƒã‚§ãƒƒã‚¯**: `npm run format:check`ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
- **è‡ªå‹•ä¿®æ­£**: `npm run format`ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé©ç”¨
- **æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: ä½œæˆæ™‚ç‚¹ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

#### æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰
- **Go**: golangci-lintã§æ¤œå‡ºã•ã‚Œã‚‹æœªä½¿ç”¨é–¢æ•°ãƒ»importå‰Šé™¤
- **TypeScript**: ESLintãƒ«ãƒ¼ãƒ«ã§æ¤œå‡ºã•ã‚Œã‚‹æœªä½¿ç”¨å¤‰æ•°å‰Šé™¤

### 6. Dockeré–¢é€£ãƒ«ãƒ¼ãƒ«

#### Docker Compose
- **ç¾ä»£çš„æ§‹æ–‡ä½¿ç”¨**: `docker compose`ï¼ˆV2ï¼‰ã‚’ä½¿ç”¨ã€`docker-compose`ï¼ˆV1ï¼‰ã¯é¿ã‘ã‚‹
- **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**: æœ¬ç•ªãƒ»é–‹ç™ºä¸¡ç’°å¢ƒã§ã®ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½

#### Dockerfile
- **ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰**: æœ¬ç•ªç”¨Dockerfileã¯ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸æ§‹æˆ
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: é•·æ™‚é–“å®Ÿè¡Œã‚µãƒ¼ãƒ“ã‚¹ã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š

### 7. ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»Codecovè¨­å®š

#### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
```bash
# Backend (Go)
cd backend && go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html

# Frontend (React Native)
cd frontend && npm test -- --coverage --watchAll=false
```

#### Codecovè¨­å®š
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–**: `fail_ci_if_error: false`ã‚’è¨­å®šã—ã¦CIå¤±æ•—ã‚’é˜²ã
- **ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®š**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã¯`CODECOV_TOKEN`ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¨­å®š
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†é›¢**: `flags: backend`/`flags: frontend`ã§åˆ†é›¢ã—ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

#### Codecov 429ã‚¨ãƒ©ãƒ¼å¯¾ç­–
```yaml
# CIè¨­å®šä¾‹
- name: Upload coverage reports to Codecov
  uses: codecov/codecov-action@v4
  with:
    fail_ci_if_error: false  # ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ™‚ã‚‚CIå¤±æ•—ã•ã›ãªã„
    token: ${{ secrets.CODECOV_TOKEN }}  # ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿
```

## ğŸ”„ æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### æ–°æ©Ÿèƒ½é–‹ç™ºæ™‚
1. **ãƒ–ãƒ©ãƒ³ãƒä½œæˆ**
2. **å®Ÿè£… + ãƒ†ã‚¹ãƒˆä½œæˆ**
3. **ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼** (ä¸Šè¨˜ãƒã‚§ãƒƒã‚¯é …ç›®å®Ÿè¡Œ)
4. **ã‚³ãƒŸãƒƒãƒˆ** (é©åˆ‡ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
5. **ãƒ—ãƒƒã‚·ãƒ¥å‰çµ±åˆãƒ†ã‚¹ãƒˆ**
6. **ãƒ—ãƒƒã‚·ãƒ¥**
7. **CIçµæœç¢ºèª** (å¤±æ•—æ™‚ã¯ä¿®æ­£å¾Œå†ãƒ—ãƒƒã‚·ãƒ¥)

### ä¾å­˜é–¢ä¿‚è¿½åŠ æ™‚
1. **ä¾å­˜é–¢ä¿‚è¿½åŠ **
2. **lock ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ç¢ºèª**
3. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
4. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°** (å¿…è¦ã«å¿œã˜ã¦)
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** (README.mdç­‰)

## ğŸš¨ CIå¤±æ•—æ™‚ã®å¯¾å¿œ

### æ®µéšçš„ãƒ‡ãƒãƒƒã‚°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
1. **ãƒ­ãƒ¼ã‚«ãƒ«å†ç¾**: åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«Dockerç’°å¢ƒã§å®Ÿè¡Œ
2. **ãƒ­ã‚°ç¢ºèª**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
3. **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**: package-lock.jsonã€go.sumç­‰ã®æ•´åˆæ€§ç¢ºèª
4. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª**: jest.config.jsonã€.prettierrcç­‰ã®è¨­å®šç¢ºèª
5. **æ®µéšçš„ä¿®æ­£**: 1ã¤ãšã¤å•é¡Œã‚’è§£æ±ºã—ã¦ã‚³ãƒŸãƒƒãƒˆ

### ã‚ˆãã‚ã‚‹CIå¤±æ•—ã¨å¯¾ç­–
| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | ä¸»ãªåŸå›  | å¯¾ç­– |
|-----------|---------|------|
| `golangci-lint unused` | æœªä½¿ç”¨é–¢æ•°ãƒ»import | ãƒ­ãƒ¼ã‚«ãƒ«ã§lintå®Ÿè¡Œã€è©²å½“ç®‡æ‰€å‰Šé™¤ |
| `npm ci` å¤±æ•— | package.json â†” package-lock.jsonä¸æ•´åˆ | `npm install`ã§lockæ›´æ–° |
| `No tests found` | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨ | åŸºæœ¬ãƒ†ã‚¹ãƒˆä½œæˆã€`--passWithNoTests`è¿½åŠ  |
| `Prettier check` å¤±æ•— | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸é©åˆ | `npm run format`å®Ÿè¡Œ |
| `Docker build` å¤±æ•— | ä¾å­˜é–¢ä¿‚ãƒ»è¨­å®šå•é¡Œ | ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `Codecov 429` ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å›æ•°è¶…é | `fail_ci_if_error: false`è¨­å®šã€ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨ |
| `Type check` å¤±æ•— | TypeScriptå‹ã‚¨ãƒ©ãƒ¼ | `npm run type-check`ã§ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª |
| `Coverage threshold` | ã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³ | ãƒ†ã‚¹ãƒˆè¿½åŠ ã€ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤èª¿æ•´ |

## ğŸ“ ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### è‰¯ã„ä¾‹
```
feat: add user authentication with JWT
test: add comprehensive tests for auth middleware
fix: resolve Docker Compose V2 compatibility issue
docs: update API documentation for auth endpoints
```

### é¿ã‘ã‚‹ã¹ãä¾‹
```
fix: CI error          // ä½•ã®CIï¼Ÿã©ã‚“ãªã‚¨ãƒ©ãƒ¼ï¼Ÿ
update package.json    // ä½•ã‚’è¿½åŠ /å¤‰æ›´ã—ãŸã®ã‹ä¸æ˜
fix stuff              // æŠ½è±¡çš„ã™ãã‚‹
```

## ğŸ”§ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

æ–°ã—ã„é–‹ç™ºè€…ã¯ä»¥ä¸‹ã‚’å¿…ãšå®Ÿè¡Œï¼š

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repo-url>
cd morrow-II

# 2. é–‹ç™ºç’°å¢ƒãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
docker compose build

# 3. å„ç¨®ãƒã‚§ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰å‹•ä½œç¢ºèª
cd frontend && docker run --rm -v $(pwd):/app -w /app node:18-alpine npm ci
cd ../backend && docker run --rm -v $(pwd):/app -w /app golangci/golangci-lint:latest golangci-lint run

# 4. çµ±åˆãƒ†ã‚¹ãƒˆ
docker compose up --build
```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆå‰ã«å¿…ãšç¢ºèªï¼š

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§å…¨ã¦ã®lint/testãŒé€šé
- [ ] ä¾å­˜é–¢ä¿‚è¿½åŠ æ™‚ã¯lockãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ›´æ–°æ¸ˆã¿
- [ ] æ–°æ©Ÿèƒ½ã«ã¯ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ æ¸ˆã¿
- [ ] ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ãŒé€šé
- [ ] Dockerãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸ
- [ ] é©åˆ‡ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ç”¨
- [ ] CIå¤±æ•—æ™‚ã¯æ®µéšçš„ãƒ‡ãƒãƒƒã‚°ã‚’å®Ÿæ–½

---

**ã“ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã§ã€PR #4 ã®ã‚ˆã†ãªç¹°ã‚Šè¿”ã—CIå¤±æ•—ã‚’é˜²ãã€åŠ¹ç‡çš„ãªé–‹ç™ºã‚’å®Ÿç¾ã—ã¾ã™ã€‚**
